# Stablecoin Transfer Indexer

> [SQD Pipes SDK Documentation](https://beta.docs.sqd.dev/en/sdk/pipes-sdk/evm.autogenerated/quickstart)

Indexes stablecoin transfer events across multiple EVM networks and stores them in PostgreSQL using the [SQD Pipes SDK](https://docs.sqd.dev/).

## Supported Networks
This example support any EVM chain also supported by the SQD network. Refer to [this page](https://beta.docs.sqd.dev/en/data/networks/evm) for a full list of chains

## Supported Stablecoins

Each network has a curated list of stablecoins (USDT, USDC, DAI, FDUSD, etc.) defined in `src/tokens.ts`.

## Prerequisites

- Node.js 20+
- pnpm
- Docker (for PostgreSQL)

## Setup

1. Install dependencies:
```bash
pnpm install
```

2. Start the database:
```bash
docker compose up -d
```

3. Create a `.env` file:
```
cp .env.example .env
```

4. Run migrations:

```bash
pnpm migration:generate && pnpm migration:migrate
```

## Development

Start the indexer:
```bash
pnpm dev
```

Monitor metrics (optional):
```bash
pnpm dlx @sqd-pipes/pipe-ui
```

## Production

Build and run:
```bash
pnpm build
pnpm start
```

## Adding New Tables/Schemas

1. **Define the table** in `src/schemas.ts`:

```typescript
export const myNewTable = pgTable("my_new_table", {
  id: serial().primaryKey(),
  network: networkEnum().notNull(),
  someField: varchar().notNull(),
  createdAt: timestamp(),
});

export type MyNewRecord = typeof myNewTable.$inferInsert;
```

2. **Export the table** in the default export:

```typescript
export default {
  transfersTable,
  myNewTable, // add here
};
```

3. **Generate and apply migration**:

```bash
pnpm migration:generate
pnpm migration:migrate
```

4. **Use in your pipeline** (`src/index.ts`):

```typescript
import { myNewTable } from "./schemas";

// In drizzleTarget config:
drizzleTarget({
  db: drizzle(DB_CONNECTION_STR),
  tables: [transfersTable, myNewTable], // register for reorg handling
  onData: async ({ tx, data }) => {
    await tx.insert(myNewTable).values(data);
  },
});
```